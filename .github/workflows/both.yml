name: Rustdesk Desktop
env:
  Root: "C:\\Users\\runneradmin\\Desktop\\software"
  Prog: "C:\\Program Files\\RustDesk"
  Name: "administrator"
  Pwd:	"Del674569"
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Downloading & Installing RustDesk
        run: |
          New-Item -Path ${{ env.Root }} -ItemType Directory  > null
          Invoke-WebRequest 'https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.exe' -Outfile ${{ env.Root }}\rustdesk.exe
          Start-Process ${{ env.Root }}\rustdesk.exe --silent-install
          Start-Sleep -seconds 20
          
      - name: Log In To Rustdesk
        run: | 
            $ServiceName = 'Rustdesk'
            $arrService = Get-Service -Name $ServiceName -ErrorAction SilentlyContinue
            if ($arrService -eq $null)
            {
                Write-Output "Installing service"
                Start-Process ${{ env.Root }}\rustdesk.exe --install-service
                Start-Sleep -seconds 20
            }
            
            while ($arrService.Status -ne 'Running')
            {
                Start-Service $ServiceName
                Start-Sleep -seconds 5
                $arrService.Refresh()
            }
            & "${{ env.Prog }}\rustdesk.exe" --get-id | Write-Output -OutVariable rustdesk_id
            & "${{ env.Prog }}\rustdesk.exe" --config "access-mode=full"
            & "${{ env.Prog }}\rustdesk.exe" --password ${{ env.Pwd }}
            
            Write-Output "..............................................."
            Write-Output "RustDesk ID: $rustdesk_id"
            Write-Output "Password: ${{ env.Pwd }}"
      - name: Downloading and Installing Essential.
        run: | 
          Invoke-WebRequest https://localtonet.com/download/localtonet-win-64.zip -OutFile localtonet.zip
          Invoke-WebRequest https://raw.githubusercontent.com/bdsoftpro/git-rdp/master/start.bat -OutFile start.bat
          Invoke-WebRequest https://raw.githubusercontent.com/bdsoftpro/git-rdp/master/wallpaper.png -OutFile wallpaper.png
          Invoke-WebRequest https://raw.githubusercontent.com/bdsoftpro/git-rdp/master/wallpaper.bat -OutFile wallpaper.bat
          Invoke-WebRequest https://vscode.download.prss.microsoft.com/dbazure/download/stable/d78a74bcdfad14d5d3b1b782f87255d802b57511/VSCodeUserSetup-x64-1.94.0.exe -OutFile VSCodeUserSetup.exe
          Invoke-WebRequest https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v8.6.7/npp.8.6.7.Installer.x64.exe -OutFile npp.exe
      - name: Time Counter
        run: Do {Start-Sleep -Seconds 10;} While (2 -eq 2)
